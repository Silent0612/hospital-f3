"use strict";(self["webpackChunkhospital_web"]=self["webpackChunkhospital_web"]||[]).push([[467],{7467:(t,e,a)=>{a.r(e),a.d(e,{default:()=>d});a(2675),a(9463);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"records-container"},[e("div",{staticClass:"page-header"},[e("h2",{staticClass:"page-title"},[t._v("我的预约记录")]),e("div",{staticClass:"header-desc"},[t._v("共 "+t._s(t.total)+" 条记录")])]),e("el-card",{staticClass:"records-card",attrs:{shadow:"hover"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.records,"header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"},"row-class-name":t.tableRowClassName}},[e("el-table-column",{attrs:{prop:"doctorName",label:"医生姓名","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"doctor-name"},[e("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(a.row.doctorName)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"departmentName",label:"就诊科室","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{size:"medium",type:t.getDepartmentTagType(a.row.departmentName)}},[t._v(" "+t._s(a.row.departmentName)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"appointmentDate",label:"就诊日期","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"date-info"},[e("i",{staticClass:"el-icon-date"}),t._v(" "+t._s(t.formatDate(a.row.appointmentDate))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"timeSlot",label:"就诊时段","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"time-info"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.getTimeSlotLabel(a.row.timeSlot))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"description",label:"症状描述","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"description-cell"},[e("i",{staticClass:"el-icon-document"}),t._v(" "+t._s(a.row.description)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{staticClass:"status-tag",attrs:{type:t.getStatusType(a.row.status),effect:"dark",size:"medium"}},[t._v(" "+t._s(t.getStatusLabel(a.row.status))+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作","min-width":"120",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.canCancel(a.row)?e("el-button",{staticClass:"cancel-btn",attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.handleCancel(a.row)}}},[t._v(" 取消预约 ")]):t._e()]}}])})],1),t.total>0?e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-size":10,layout:"prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1):t._e()],1)],1)},n=[],o=a(4048),s=a(388);a(8706),a(4346),a(4114),a(3288),a(9432),a(8156);const i={name:"Records",data:function(){return{loading:!1,records:[],currentPage:1,total:0,timeSlots:{1:"上午 8:00-10:00",2:"上午 10:00-12:00",3:"下午 14:00-16:00",4:"下午 16:00-18:00"}}},created:function(){this.getRecords()},methods:{tableRowClassName:function(t){var e=t.row;return 2===e.status?"cancelled-row":""},getDepartmentTagType:function(t){var e={内科:"",外科:"success",儿科:"warning",妇科:"danger",眼科:"info",耳鼻喉科:""};return e[t]||""},getRecords:function(){var t=this;return(0,s.A)((0,o.A)().mark((function e(){var a,r,n;return(0,o.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading=!0,e.prev=1,a=JSON.parse(localStorage.getItem("userInfo")||"{}"),console.log("当前用户信息:",a),a.id){e.next=8;break}return t.$message.error("请先登录"),t.$router.push("/login"),e.abrupt("return");case 8:return e.next=10,t.$http.get("/api/appointments/user/".concat(a.id));case 10:r=e.sent,console.log("预约记录响应:",r),r.data&&200===r.data.code?Array.isArray(r.data.data)?(t.records=r.data.data,t.total=t.records.length,console.log("获取到的预约记录:",t.records)):(console.error("返回的数据不是数组:",r.data.data),t.records=[],t.total=0):t.$message.error((null===(n=r.data)||void 0===n?void 0:n.message)||"获取预约记录失败"),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](1),console.error("获取预约记录错误:",e.t0),t.$message.error("获取预约记录失败，请稍后重试");case 19:return e.prev=19,t.loading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,15,19,22]])})))()},formatDate:function(t){if(!t)return"";var e=new Date(t);return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))},getTimeSlotLabel:function(t){return this.timeSlots[t]||"未知时段"},getStatusType:function(t){var e={0:"warning",1:"success",2:"info"};return e[t]||"info"},getStatusLabel:function(t){var e={0:"待就诊",1:"已完成",2:"已取消"};return e[t]||"未知状态"},canCancel:function(t){return 0===t.status&&new Date(t.appointmentDate)>new Date},handleCurrentChange:function(t){this.currentPage=t,this.getRecords()},handleCancel:function(t){var e=this;return(0,s.A)((0,o.A)().mark((function a(){var r,n;return(0,o.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,e.$confirm("确认取消该预约吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return a.next=5,e.$http.put("/api/appointments/".concat(t.id,"/cancel"));case 5:r=a.sent,r.data&&200===r.data.code?(e.$message.success("预约取消成功"),e.getRecords()):e.$message.error((null===(n=r.data)||void 0===n?void 0:n.message)||"取消预约失败"),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),"cancel"!==a.t0&&(console.error("取消预约错误:",a.t0),e.$message.error("取消预约失败，请稍后重试"));case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()}}},c=i;var l=a(1656),u=(0,l.A)(c,r,n,!1,null,"00dab056",null);const d=u.exports},3063:(t,e,a)=>{var r=a(2839);t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},533:(t,e,a)=>{var r=a(9504),n=a(8014),o=a(655),s=a(2333),i=a(7750),c=r(s),l=r("".slice),u=Math.ceil,d=function(t){return function(e,a,r){var s,d,p=o(i(e)),f=n(a),g=p.length,m=void 0===r?" ":o(r);return f<=g||""===m?p:(s=f-g,d=c(m,u(s/m.length)),d.length>s&&(d=l(d,0,s)),t?p+d:d+p)}};t.exports={start:d(!1),end:d(!0)}},2333:(t,e,a)=>{var r=a(1291),n=a(655),o=a(7750),s=RangeError;t.exports=function(t){var e=n(o(this)),a="",i=r(t);if(i<0||i===1/0)throw new s("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(e+=e))1&i&&(a+=e);return a}},8706:(t,e,a)=>{var r=a(6518),n=a(9039),o=a(4376),s=a(34),i=a(8981),c=a(6198),l=a(6837),u=a(2278),d=a(1469),p=a(597),f=a(8227),g=a(9519),m=f("isConcatSpreadable"),v=g>=51||!n((function(){var t=[];return t[m]=!1,t.concat()[0]!==t})),h=function(t){if(!s(t))return!1;var e=t[m];return void 0!==e?!!e:o(t)},w=!v||!p("concat");r({target:"Array",proto:!0,arity:1,forced:w},{concat:function(t){var e,a,r,n,o,s=i(this),p=d(s,0),f=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?s:arguments[e],h(o))for(n=c(o),l(f+n),a=0;a<n;a++,f++)a in o&&u(p,f,o[a]);else l(f+1),u(p,f++,o);return p.length=f,p}})},4346:(t,e,a)=>{var r=a(6518),n=a(4376);r({target:"Array",stat:!0},{isArray:n})},3288:(t,e,a)=>{var r=a(9504),n=a(6840),o=Date.prototype,s="Invalid Date",i="toString",c=r(o[i]),l=r(o.getTime);String(new Date(NaN))!==s&&n(o,i,(function(){var t=l(this);return t===t?c(this):s}))},8156:(t,e,a)=>{var r=a(6518),n=a(533).start,o=a(3063);r({target:"String",proto:!0,forced:o},{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=467.62829b6c.js.map