"use strict";(self["webpackChunkhospital_web"]=self["webpackChunkhospital_web"]||[]).push([[54],{9054:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});r(2675),r(9463);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"appointment-container"},[t("div",{staticClass:"page-header"},[t("el-page-header",{attrs:{content:"预约挂号"},on:{back:function(t){return e.$router.go(-1)}}})],1),t("el-card",{staticClass:"appointment-card"},[t("div",{staticClass:"doctor-info"},[t("div",{staticClass:"doctor-avatar"},[e.doctorInfo.headimg?t("img",{attrs:{src:e.doctorInfo.headimg,alt:"医生头像"}}):t("i",{staticClass:"el-icon-user-solid"})]),t("div",{staticClass:"info-content"},[t("h3",[e._v(e._s(e.doctorInfo.username))]),e.doctorInfo.experience?t("p",[e._v(e._s(e.doctorInfo.experience))]):e._e(),e.doctorInfo.comment?t("p",[e._v(e._s(e.doctorInfo.comment))]):e._e()])]),t("el-form",{ref:"appointmentForm",staticClass:"appointment-form",attrs:{model:e.appointmentForm,rules:e.rules,"label-width":"100px"}},[t("div",{staticClass:"section-title"},[e._v("患者信息")]),t("el-form-item",{attrs:{label:"姓名",prop:"userName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.appointmentForm.userName,callback:function(t){e.$set(e.appointmentForm,"userName",t)},expression:"appointmentForm.userName"}})],1),t("el-form-item",{attrs:{label:"性别",prop:"userGender"}},[t("el-input",{attrs:{value:1===e.appointmentForm.userGender?"男":"女",disabled:""}})],1),t("el-form-item",{attrs:{label:"年龄",prop:"userAge"}},[t("el-input",{attrs:{disabled:""},model:{value:e.appointmentForm.userAge,callback:function(t){e.$set(e.appointmentForm,"userAge",t)},expression:"appointmentForm.userAge"}})],1),t("div",{staticClass:"section-title"},[e._v("预约信息")]),t("el-form-item",{attrs:{label:"就诊日期",prop:"appointmentDate"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择就诊日期","picker-options":e.dateOptions},model:{value:e.appointmentForm.appointmentDate,callback:function(t){e.$set(e.appointmentForm,"appointmentDate",t)},expression:"appointmentForm.appointmentDate"}})],1),t("el-form-item",{attrs:{label:"就诊时段",prop:"timeSlot"}},[t("el-select",{attrs:{placeholder:"请选择就诊时段"},model:{value:e.appointmentForm.timeSlot,callback:function(t){e.$set(e.appointmentForm,"timeSlot",t)},expression:"appointmentForm.timeSlot"}},e._l(e.timeSlots,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"就诊类型",prop:"visitType"}},[t("el-radio-group",{model:{value:e.appointmentForm.visitType,callback:function(t){e.$set(e.appointmentForm,"visitType",t)},expression:"appointmentForm.visitType"}},[t("el-radio",{attrs:{label:1}},[e._v("初诊")]),t("el-radio",{attrs:{label:2}},[e._v("复诊")])],1)],1),t("el-form-item",{attrs:{label:"病情描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请简要描述您的病情"},model:{value:e.appointmentForm.description,callback:function(t){e.$set(e.appointmentForm,"description",t)},expression:"appointmentForm.description"}})],1),t("div",{staticClass:"fee-info"},[t("span",{staticClass:"fee-label"},[e._v("挂号费用：")]),t("span",{staticClass:"fee-amount"},[e._v("￥"+e._s(e.registrationFee))])]),t("el-form-item",[t("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:e.submitAppointment}},[e._v("确认预约并支付")])],1)],1)],1)],1)},n=[],o=r(4048),i=r(388);r(4114),r(9089),r(3288),r(9432),r(8940);const s={name:"Appointment",data:function(){return{doctorInfo:{},appointmentForm:{appointmentDate:"",timeSlot:"",visitType:1,description:"",userName:"",userGender:null,userAge:null},rules:{appointmentDate:[{required:!0,message:"请选择就诊日期",trigger:"change"}],timeSlot:[{required:!0,message:"请选择就诊时段",trigger:"change"}],visitType:[{required:!0,message:"请选择就诊类型",trigger:"change"}],description:[{required:!0,message:"请填写病情描述",trigger:"blur"}]},timeSlots:[{value:"1",label:"上午 8:00-10:00"},{value:"2",label:"上午 10:00-12:00"},{value:"3",label:"下午 14:00-16:00"},{value:"4",label:"下午 16:00-18:00"}],dateOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},registrationFee:50}},created:function(){this.getDoctorInfo(),this.getUserInfo()},methods:{getDoctorInfo:function(){var e=this;return(0,i.A)((0,o.A)().mark((function t(){var r,a;return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.get("/api/empinfo/findById?id=".concat(e.$route.params.doctorId));case 3:r=t.sent,a=r.data,200===a.code?e.doctorInfo=a.data:e.$message.error(a.message),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$message.error("获取医生信息失败");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getUserInfo:function(){try{var e=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!e.id)return this.$message.error("请先登录"),void this.$router.push("/login");if(this.appointmentForm.userName=e.username,this.appointmentForm.userGender=e.gender,e.birthday){var t=new Date(e.birthday),r=new Date,a=r.getFullYear()-t.getFullYear(),n=r.getMonth()-t.getMonth();(n<0||0===n&&r.getDate()<t.getDate())&&a--,this.appointmentForm.userAge=a}}catch(o){console.error("获取用户信息失败:",o),this.$message.error("获取用户信息失败")}},submitAppointment:function(){var e=this;return(0,i.A)((0,o.A)().mark((function t(){return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.appointmentForm.validate(function(){var t=(0,i.A)((0,o.A)().mark((function t(r){var a,n,i,s;return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,a=JSON.parse(localStorage.getItem("userInfo")||"{}"),a.id){t.next=8;break}return e.$message.error("请先登录"),e.$router.push("/login"),t.abrupt("return");case 8:return n={doctorId:parseInt(e.$route.params.doctorId),userId:parseInt(a.id),appointmentDate:e.appointmentForm.appointmentDate,timeSlot:e.appointmentForm.timeSlot,visitType:parseInt(e.appointmentForm.visitType),description:e.appointmentForm.description,fee:e.registrationFee,userName:e.appointmentForm.userName,userGender:e.appointmentForm.userGender,userAge:e.appointmentForm.userAge},console.log("提交的预约数据:",n),t.next=12,e.$http.post("/api/appointments",n);case 12:i=t.sent,i.data&&200===i.data.code?e.$alert("预约成功！请按时就医。","预约结果",{confirmButtonText:"确定",type:"success",callback:function(){e.$router.push("/home/records")}}):e.$message.error((null===(s=i.data)||void 0===s?void 0:s.message)||"预约失败"),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](2),console.error("预约错误:",t.t0),e.$message.error("预约失败，请稍后重试");case 20:case"end":return t.stop()}}),t,null,[[2,16]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()}}},p=s;var l=r(1656),m=(0,l.A)(p,a,n,!1,null,"20ee6e1a",null);const c=m.exports},2703:(e,t,r)=>{var a=r(2195),n=r(9039),o=r(9504),i=r(655),s=r(3802).trim,p=r(7452),l=a.parseInt,m=a.Symbol,c=m&&m.iterator,u=/^[+-]?0x/i,d=o(u.exec),f=8!==l(p+"08")||22!==l(p+"0x16")||c&&!n((function(){l(Object(c))}));e.exports=f?function(e,t){var r=s(i(e));return l(r,t>>>0||(d(u,r)?16:10))}:l},9089:(e,t,r)=>{var a=r(6518),n=r(9504),o=Date,i=n(o.prototype.getTime);a({target:"Date",stat:!0},{now:function(){return i(new o)}})},3288:(e,t,r)=>{var a=r(9504),n=r(6840),o=Date.prototype,i="Invalid Date",s="toString",p=a(o[s]),l=a(o.getTime);String(new Date(NaN))!==i&&n(o,s,(function(){var e=l(this);return e===e?p(this):i}))},8940:(e,t,r)=>{var a=r(6518),n=r(2703);a({global:!0,forced:parseInt!==n},{parseInt:n})}}]);
//# sourceMappingURL=54.8ec55763.js.map