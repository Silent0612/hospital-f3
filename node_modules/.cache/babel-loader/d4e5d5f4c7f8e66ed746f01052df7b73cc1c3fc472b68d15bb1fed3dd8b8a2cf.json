{"ast":null,"code":"import _regeneratorRuntime from \"D:/hospital-master2/hospital-web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/hospital-master2/hospital-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.string.pad-start.js\";\nexport default {\n  name: 'Records',\n  data: function data() {\n    return {\n      records: [],\n      loading: false,\n      status: '',\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      timeSlots: {\n        '1': '上午',\n        '2': '下午'\n      },\n      visitTypes: {\n        '1': '初诊',\n        '2': '复诊'\n      },\n      statusMap: {\n        '0': '待就诊',\n        '1': '已完成',\n        '2': '已取消'\n      }\n    };\n  },\n  created: function created() {\n    this.getRecords();\n  },\n  methods: {\n    getRecords: function getRecords() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this.loading = true;\n              _context.prev = 1;\n              _context.next = 4;\n              return _this.$http.get('/api/appointment/list', {\n                params: {\n                  page: _this.currentPage,\n                  size: _this.pageSize,\n                  status: _this.status\n                }\n              });\n            case 4:\n              res = _context.sent;\n              if (res.data.code === 200) {\n                _this.records = res.data.data.records;\n                _this.total = res.data.data.total;\n              }\n              _context.next = 11;\n              break;\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              _this.$message.error('获取预约记录失败');\n            case 11:\n              _context.prev = 11;\n              _this.loading = false;\n              return _context.finish(11);\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 8, 11, 14]]);\n      }))();\n    },\n    formatDate: function formatDate(date) {\n      if (!date) return '';\n      var d = new Date(date);\n      return \"\".concat(d.getFullYear(), \"-\").concat(String(d.getMonth() + 1).padStart(2, '0'), \"-\").concat(String(d.getDate()).padStart(2, '0'));\n    },\n    getStatusType: function getStatusType(status) {\n      var types = {\n        '0': 'warning',\n        '1': 'success',\n        '2': 'info'\n      };\n      return types[status] || 'info';\n    },\n    cancelAppointment: function cancelAppointment(record) {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return _this2.$confirm('确定要取消该预约吗？', '提示', {\n                type: 'warning'\n              });\n            case 3:\n              _context2.next = 5;\n              return _this2.$http.put(\"/api/appointment/cancel/\".concat(record.id));\n            case 5:\n              res = _context2.sent;\n              if (res.data.code === 200) {\n                _this2.$message.success('取消预约成功');\n                _this2.getRecords();\n              }\n              _context2.next = 12;\n              break;\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              if (_context2.t0 !== 'cancel') {\n                _this2.$message.error('取消预约失败');\n              }\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 9]]);\n      }))();\n    },\n    handleCurrentChange: function handleCurrentChange(page) {\n      this.currentPage = page;\n      this.getRecords();\n    }\n  }\n};","map":{"version":3,"names":["name","data","records","loading","status","currentPage","pageSize","total","timeSlots","visitTypes","statusMap","created","getRecords","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","wrap","_callee$","_context","prev","next","$http","get","params","page","size","sent","code","t0","$message","error","finish","stop","formatDate","date","d","Date","concat","getFullYear","String","getMonth","padStart","getDate","getStatusType","types","cancelAppointment","record","_this2","_callee2","_callee2$","_context2","$confirm","type","put","id","success","handleCurrentChange"],"sources":["src/views/Records.vue"],"sourcesContent":["<template>\r\n  <div class=\"records-page page-container\">\r\n    <h1 class=\"page-title\">预约记录</h1>\r\n    <el-card class=\"records-card\">\r\n      <div class=\"filter-section\">\r\n        <el-form :inline=\"true\" class=\"filter-form\">\r\n          <el-form-item label=\"预约状态\">\r\n            <el-select v-model=\"status\" placeholder=\"请选择状态\" clearable>\r\n              <el-option label=\"待就诊\" value=\"0\"></el-option>\r\n              <el-option label=\"已完成\" value=\"1\"></el-option>\r\n              <el-option label=\"已取消\" value=\"2\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item>\r\n            <el-button type=\"primary\" @click=\"getRecords\">查询</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n      \r\n      <el-table \r\n        :data=\"records\" \r\n        border \r\n        stripe\r\n        class=\"records-table\"\r\n        v-loading=\"loading\">\r\n        <el-table-column prop=\"id\" label=\"预约编号\" width=\"100\"></el-table-column>\r\n        <el-table-column prop=\"departmentName\" label=\"科室\" width=\"120\"></el-table-column>\r\n        <el-table-column prop=\"doctorName\" label=\"医生\" width=\"120\"></el-table-column>\r\n        <el-table-column prop=\"appointmentDate\" label=\"预约日期\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            {{ formatDate(scope.row.appointmentDate) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"timeSlot\" label=\"时间段\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            {{ timeSlots[scope.row.timeSlot] || '未知时段' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"visitType\" label=\"就诊类型\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            {{ visitTypes[scope.row.visitType] || '未知类型' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"description\" label=\"症状描述\" show-overflow-tooltip></el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag :type=\"getStatusType(scope.row.status)\">\r\n              {{ statusMap[scope.row.status] }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"120\" fixed=\"right\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button \r\n              v-if=\"scope.row.status === 0\"\r\n              type=\"text\" \r\n              @click=\"cancelAppointment(scope.row)\">\r\n              取消预约\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      \r\n      <div class=\"pagination-section\">\r\n        <el-pagination\r\n          @current-change=\"handleCurrentChange\"\r\n          :current-page=\"currentPage\"\r\n          :page-size=\"pageSize\"\r\n          layout=\"total, prev, pager, next\"\r\n          :total=\"total\">\r\n        </el-pagination>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'Records',\r\n  data() {\r\n    return {\r\n      records: [],\r\n      loading: false,\r\n      status: '',\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      timeSlots: {\r\n        '1': '上午',\r\n        '2': '下午'\r\n      },\r\n      visitTypes: {\r\n        '1': '初诊',\r\n        '2': '复诊'\r\n      },\r\n      statusMap: {\r\n        '0': '待就诊',\r\n        '1': '已完成',\r\n        '2': '已取消'\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.getRecords()\r\n  },\r\n  methods: {\r\n    async getRecords() {\r\n      this.loading = true\r\n      try {\r\n        const res = await this.$http.get('/api/appointment/list', {\r\n          params: {\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n            status: this.status\r\n          }\r\n        })\r\n        if (res.data.code === 200) {\r\n          this.records = res.data.data.records\r\n          this.total = res.data.data.total\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取预约记录失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    formatDate(date) {\r\n      if (!date) return ''\r\n      const d = new Date(date)\r\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`\r\n    },\r\n    getStatusType(status) {\r\n      const types = {\r\n        '0': 'warning',\r\n        '1': 'success',\r\n        '2': 'info'\r\n      }\r\n      return types[status] || 'info'\r\n    },\r\n    async cancelAppointment(record) {\r\n      try {\r\n        await this.$confirm('确定要取消该预约吗？', '提示', {\r\n          type: 'warning'\r\n        })\r\n        const res = await this.$http.put(`/api/appointment/cancel/${record.id}`)\r\n        if (res.data.code === 200) {\r\n          this.$message.success('取消预约成功')\r\n          this.getRecords()\r\n        }\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          this.$message.error('取消预约失败')\r\n        }\r\n      }\r\n    },\r\n    handleCurrentChange(page) {\r\n      this.currentPage = page\r\n      this.getRecords()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.records-page {\r\n  .records-card {\r\n    background: rgba(255, 255, 255, 0.9);\r\n    \r\n    .filter-section {\r\n      margin-bottom: 20px;\r\n      \r\n      .filter-form {\r\n        display: flex;\r\n        align-items: center;\r\n        \r\n        .el-form-item {\r\n          margin-bottom: 0;\r\n          margin-right: 20px;\r\n          \r\n          &:last-child {\r\n            margin-right: 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    .records-table {\r\n      margin-bottom: 20px;\r\n      \r\n      .el-button--text {\r\n        padding: 0;\r\n        height: auto;\r\n        \r\n        &:hover {\r\n          color: #66b1ff;\r\n        }\r\n      }\r\n      \r\n      .el-tag {\r\n        border-radius: 4px;\r\n      }\r\n    }\r\n    \r\n    .pagination-section {\r\n      display: flex;\r\n      justify-content: center;\r\n      padding-top: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n// 覆盖 Element UI 的默认样式\r\n:deep(.el-table) {\r\n  th {\r\n    background-color: #f5f7fa;\r\n    color: #606266;\r\n    font-weight: 500;\r\n  }\r\n  \r\n  td {\r\n    padding: 8px 0;\r\n  }\r\n  \r\n  .el-table__row:hover {\r\n    background-color: #f5f7fa;\r\n  }\r\n}\r\n\r\n:deep(.el-pagination) {\r\n  .el-pagination__total {\r\n    margin-right: 20px;\r\n  }\r\n  \r\n  .btn-prev,\r\n  .btn-next {\r\n    background: transparent;\r\n    \r\n    &:hover {\r\n      color: #409EFF;\r\n    }\r\n  }\r\n  \r\n  .el-pager li {\r\n    background: transparent;\r\n    \r\n    &:hover {\r\n      color: #409EFF;\r\n    }\r\n    \r\n    &.active {\r\n      background-color: #409EFF;\r\n      color: #fff;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}